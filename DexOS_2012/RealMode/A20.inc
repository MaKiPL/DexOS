;=========================================================;
; A20                                          01/05/2011 ;
;---------------------------------------------------------;
;                                                         ;
; Enable the A20 line.                                    ;
;                                                         ;
; (c) Craig Bamford, All rights reserved.                 ;
;=========================================================;

;=======================================================  ;
; Enable_A20.                                             ;
;=======================================================  ;  
Enable_A20:                                               ;
	pusha                                             ;
	cli	                                          ;			       
	cld                                               ;
	mov     al,255	                                  ;		       
	out     0xa1,al                                   ;
	out     0x21,al                                   ;
l.5:	in      al,0x64	                                  ;		       
	test    al,2	                                  ;		       
	jnz     l.5	                                  ;		       
	mov     al,0xD1	                                  ;		       
	out     0x64,al	                                  ;		       
l.6:	in      al,0x64	                                  ;		       
	test    al,2                                      ;
	jnz     l.6	                                  ;		       
	mov     al,0xDF	                                  ;		       
	out     0x60,al			                  ;
	mov     cx,14h                                    ;
l.7:					                  ;  
	out     0edh,ax			                  ;
	loop    l.7			                  ;
	sti                                               ;
	popa                                              ;
	ret                                               ;

